# HTTP -> redirecció a HTTPS
<VirtualHost *:80>
    ServerName frontend.local

    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^/(.*)$ https://frontend.local/$1 [R=301,L]

    ErrorLog "logs/frontend-http-error.log"
    CustomLog "logs/frontend-http-access.log" json
</VirtualHost>

# HTTPS frontend.local
<VirtualHost *:443>
    ServerName frontend.local
    DocumentRoot "/usr/local/apache2/sites/frontend"

    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/certs/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/certs/server.key"

    <Directory "/usr/local/apache2/sites/frontend">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Capçaleres de seguretat
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'"

    ErrorLog "logs/frontend-https-error.log"
    CustomLog "logs/frontend-https-access.log" json
</VirtualHost>
